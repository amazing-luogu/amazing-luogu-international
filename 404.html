<!doctype html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="icon" type="image/svg+xml" href="https://cdn.luogu.com.cn/upload/image_hosting/oqhxzr7u.png" />
	<title>Amazing Luogu</title>
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/@fortawesome/fontawesome-free@7.2.0/css/all.min.css">
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css">
	<link rel="stylesheet"
		href="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.8.0/build/styles/atom-one-light.min.css">
	<link rel="stylesheet"
		href="https://cdn.jsdmirror.com/gh/zym2013/amazing-luogu-international@main/style/markdown.css">
	<link rel="stylesheet"
		href="https://cdn.jsdmirror.com/gh/zym2013/amazing-luogu-international@main/style/framework.css">
	<link rel="stylesheet"
		href="https://cdn.jsdmirror.com/gh/zym2013/amazing-luogu-international@main/style/markdown-dark.css">
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/katex@0.16.27/dist/katex.min.css">
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/animate.css@4.1.1/animate.min.css">
	<style>
		.markdown-body {
			font-size: 16px;
			line-height: 1.6;
			color: var(--text-color);
		}

		#goBtn {
			position: absolute;
			right: 68px;
			top: 3px;
			bottom: 4px;
			padding: 0 16px;
			background: var(--primary-color);
			color: white;
			border: none;
			border-radius: var(--border-radius-sm);
			cursor: pointer;
			font-weight: 500;
			transition: background 0.2s;
		}

		#urlInput {
			width: 73%;
			padding: 12px 16px;
			font-size: 1rem;
			border: 1px solid var(--border-color);
			border-radius: var(--border-radius-sm);
			background: var(--card-bg);
			color: var(--text-color);
			box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
			transition: border-color 0.2s;
		}

		.markdown-body .katex-display {
			overflow-x: auto;
			overflow-y: hidden;
		}

		.katex-display .katex {
			display: block;
		}

		.notice {
			margin-block-start: 1em;
			margin-block-end: 1em;
			margin-inline-start: 40px;
			margin-inline-end: 40px;
			unicode-bidi: isolate;
			padding: 10px 20px;
			margin: 0 0 20px;
			border-left: 5px solid #eee;
			margin-top: 30px;
			border-radius: 15px;
			background-color: var(--card-bg);
			text-align: left;
		}

		.notice h2 {
			margin-top: 0px;
		}

		.important-notice {
			border-left: 5px #f85149 solid;
		}

		.important-notice i {
			color: #f85149;
		}

		.flowing-light {
			animation-delay: 0s;
			color: #444;
			text-shadow: 0 0 0 #444;
			animation: flowing-light 1s ease-in-out infinite alternate;
			animation-delay: 0.1s;
		}

		@keyframes flowing-light {
			to {
				text-shadow: 0 0 1px #fff,
					0 0 1px #fff,
					0 0 3px #fff,
					0 0 6px #126fcc,
					0 0 7px #126fcc,
					0 0 11px #126fcc;
				color: #aaaaaa;
			}
		}

		.page-layout {
			display: flex;
			gap: 24px;
			max-width: 1400px;
			margin: 0 auto;
		}

		.main-content {
			flex: 1;
			min-width: 0;
		}

		.toc-sidebar {
			width: 240px;
			flex-shrink: 0;
			position: sticky;
			top: 80px;
			align-self: flex-start;
			background: var(--card-bg);
			border-radius: var(--border-radius-sm);
			padding: 16px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
			max-height: calc(100vh - 100px);
			overflow-y: auto;
		}

		.toc-sidebar h4 {
			margin: 0 0 12px 0;
			font-size: 1rem;
			color: var(--text-color);
			border-bottom: 1px solid var(--border-color);
			padding-bottom: 8px;
		}

		#toc-content a {
			display: block;
			padding: 4px 0;
			color: var(--text-light);
			text-decoration: none;
			font-size: 0.9rem;
			transition: color 0.2s;
		}

		#toc-content a:hover {
			color: var(--primary-color);
		}

		#toc-content .h2 {
			padding-left: 12px;
		}

		#toc-content .h3 {
			padding-left: 24px;
		}

		#toc-content .h4 {
			padding-left: 36px;
		}

		#toc-content .h5 {
			padding-left: 48px;
		}

		#toc-content .h6 {
			padding-left: 60px;
		}

		.article-header {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			align-items: center;
			margin-bottom: 16px;
			padding-bottom: 12px;
			border-bottom: 1px solid var(--border-color);
		}

		.action-btn {
			padding: 6px 12px;
			background: var(--card-bg);
			border: 1px solid var(--border-color);
			border-radius: var(--border-radius-sm);
			color: var(--text-color);
			cursor: pointer;
			font-size: 0.9rem;
			transition: all 0.2s;
			display: inline-flex;
			align-items: center;
			gap: 6px;
		}

		.action-btn:hover {
			background: var(--primary-color);
			border-color: var(--primary-color);
			color: #fff;
		}

		.save-time {
			margin-left: auto;
			font-size: 0.85rem;
			color: var(--text-light);
		}

		@media (max-width: 1100px) {
			.page-layout {
				flex-direction: column;
			}

			.toc-sidebar {
				width: 100%;
				position: static;
				max-height: 300px;
			}

			.save-time {
				margin-left: 0;
				width: 100%;
				text-align: right;
			}
		}
	</style>
</head>

<body>
	<div id="app">
		<aside class="sidebar" id="sidebar">
			<nav class="nav-menu">
				<a class="nav-logo-item" data-page="none">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" class="nav-icon" height="24" viewBox="0 0 24 24">
						<path fill="currentColor"
							d="M12.424 0c-.435-.005-.964.138-1.569.65c-.967.817-2.554 3.235-3.56 4.38s-2.002 1.65-2.48 2.493c-.477.844-.824 1.598-.385 2.568s2.308 2.592 3.018 3.247s.724.566 1.24.68c.517.113 1.38.188 1.857 0c.478-.19.993-.63 1.006-1.133s-.515-1.409-.928-1.887c-.413-.479-1.213-.769-1.549-.983s-.373-.076-.463-.303s-.413-.59-.078-1.056c.336-.466 1.38-1.033 2.09-1.738s1.625-1.61 2.167-2.492s1.06-2.064 1.085-2.794C13.901.902 13.603.285 13.1.12a2.2 2.2 0 0 0-.676-.12m-.397 6.936c-.243.008-.443.037-.566.097c-.492.24-.48.997-.151 1.515s1.618 1.223 2.124 1.59c.505.366.883.292.908.607c.026.316.102.315-.757 1.287c-.86.973-3.222 3.371-4.397 4.546c-1.175 1.174-1.77 1.503-2.654 2.5S4.259 21.78 3.88 22.563s-.15.997.38 1.212c.531.214 2.11.34 2.804.075c.695-.265.822-1.034 1.365-1.666c.543-.63.721-.859 1.896-2.122c.472-.507 1.242-1.32 1.998-2.118c.048.151.126.324.243.525c.423.727 1.922 2.219 2.537 3.009s.77 1.33 1.154 1.73c.384.402.55.564 1.152.677c.602.112 1.998.188 2.459 0c.461-.189.552-.576.308-1.127c-.243-.552-1.346-1.555-1.768-2.182c-.423-.627-1.243-2.095-1.845-2.71s-1.025-.776-1.768-.977c-.43-.115-.982-.11-1.444-.034c.769-.811 1.564-1.647 2.129-2.246c1.415-1.503 2.88-2.614 3.335-3.56c.455-.948-.214-1.492-.606-2.123c-.391-.631-1.124-1.363-1.743-1.666c-.62-.303-1.151-.1-1.972-.151c-.616-.038-1.737-.197-2.467-.173" />
					</svg>
					<span class="nav-text">Amazing Luogu 国际</span>
				</a>
				<a href="/" class="nav-item" data-page="home">
					<i class="fa-solid fa-house-chimney-user nav-icon"></i>
					<span class="nav-text">首页</span>
				</a>
				<a href="/a/y81xoxgi" class="nav-item" data-page="articles">
					<i class="fa-regular fa-newspaper nav-icon"></i>
					<span class="nav-text">文章</span>
				</a>
				<a href="/p/wnvx31ss" class="nav-item" data-page="clipboard">
					<i class="fa-solid fa-clipboard-list nav-icon"></i>
					<span class="nav-text">剪贴板</span>
				</a>
			</nav>
		</aside>
		<div class="sidebar-overlay" id="sidebarOverlay"></div>
		<div class="main-container">
			<header class="topbar">
				<div class="topbar-left">
					<button class="menu-toggle" id="menuToggle" aria-label="切换菜单">
						<i class="fas fa-bars"></i>
					</button>
					<nav class="breadcrumb" id="breadcrumb"></nav>
				</div>
				<div class="logo">
					<img src="https://cdn.luogu.com.cn/upload/image_hosting/7x00uufg.png" alt="Logo" class="logo-img">
				</div>
			</header>
			<main class="content" id="home-page">
				<div style="text-align: center; max-width: 600px; margin: 0 auto;">
					<div
						style="display: flex; align-items: center; justify-content: center; gap: 16px; margin-bottom: 32px;">
						<h1 style="font-size: 2.5rem; font-weight: 700; color: var(--secondary-color); margin: 0;">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 31.57px">
								<path fill="currentColor"
									d="M12.424 0c-.435-.005-.964.138-1.569.65c-.967.817-2.554 3.235-3.56 4.38s-2.002 1.65-2.48 2.493c-.477.844-.824 1.598-.385 2.568s2.308 2.592 3.018 3.247s.724.566 1.24.68c.517.113 1.38.188 1.857 0c.478-.19.993-.63 1.006-1.133s-.515-1.409-.928-1.887c-.413-.479-1.213-.769-1.549-.983s-.373-.076-.463-.303s-.413-.59-.078-1.056c.336-.466 1.38-1.033 2.09-1.738s1.625-1.61 2.167-2.492s1.06-2.064 1.085-2.794C13.901.902 13.603.285 13.1.12a2.2 2.2 0 0 0-.676-.12m-.397 6.936c-.243.008-.443.037-.566.097c-.492.24-.48.997-.151 1.515s1.618 1.223 2.124 1.59c.505.366.883.292.908.607c.026.316.102.315-.757 1.287c-.86.973-3.222 3.371-4.397 4.546c-1.175 1.174-1.77 1.503-2.654 2.5S4.259 21.78 3.88 22.563s-.15.997.38 1.212c.531.214 2.11.34 2.804.075c.695-.265.822-1.034 1.365-1.666c.543-.63.721-.859 1.896-2.122c.472-.507 1.242-1.32 1.998-2.118c.048.151.126.324.243.525c.423.727 1.922 2.219 2.537 3.009s.77 1.33 1.154 1.73c.384.402.55.564 1.152.677c.602.112 1.998.188 2.459 0c.461-.189.552-.576.308-1.127c-.243-.552-1.346-1.555-1.768-2.182c-.423-.627-1.243-2.095-1.845-2.71s-1.025-.776-1.768-.977c-.43-.115-.982-.11-1.444-.034c.769-.811 1.564-1.647 2.129-2.246c1.415-1.503 2.88-2.614 3.335-3.56c.455-.948-.214-1.492-.606-2.123c-.391-.631-1.124-1.363-1.743-1.666c-.62-.303-1.151-.1-1.972-.151c-.616-.038-1.737-.197-2.467-.173" />
							</svg> Amazing Luogu 国际
						</h1>
						<hr>
					</div>
					<p style="color: var(--text-light); margin-bottom: 24px;">请输入任意洛谷文章或剪贴板链接，自动跳转到国际版</p>
					<div
						style="position: relative; align-items: center; flex-direction: row; flex-wrap: nowrap; justify-content: center;">
						<input type="text" id="urlInput" placeholder="https://www.luogu.com.cn/paste/wnvx31ss，支持简写" />
						<button id="goBtn"><i class="fa-solid fa-bolt flowing-light"></i></button>
					</div>
					<div class="notice important-notice">
						<h2><i class="fa-solid fa-bell animate__animated animate__infinite animate__swing"></i> 公告：抵制
							GenGen 国际行动</h2>
						<p>GenGen 国际是由 GenGen 队（以下简称该团队）运营的保存站，在 Amazing Luogu（以下简称我方）的保存站经过该团队同意后使用该团队 API
							时，该团队通过篡改数据的方式抹黑我方。</p>
						<p>虽然交流中表明反代会增加该团队境外成本导致的该行为，但 GenGen 团队的行为还是严重违反了社区规范与社会公德，我们强烈谴责这种行为，并呼吁所有用户抵制 GenGen 国际。</p>
						<p>但该团队仍有优秀的插件，希望本事件的目的只是抵制 GenGen 国际而不是抵制 GenGen。</p>
					</div>
				</div>
			</main>
			<main class="content" id="article-page" style="display: none;">
				<div class="page-layout">
					<div class="main-content">
						<div class="article-header">
							<!-- <button id="backBtn" class="action-btn"><i class="fa-solid fa-arrow-left"></i> 返回</button> -->
							<button id="refreshBtn" class="action-btn"><i class="fa-solid fa-rotate"></i> 更新</button>
							<button id="copyRawBtn" class="action-btn"><i class="fa-solid fa-copy"></i> 复制原文</button>
							<button id="jumpOriginalBtn" class="action-btn"><i class="fa-solid fa-external-link"></i>
								跳转原文</button>
							<span id="saveTime" class="save-time"></span>
						</div>
						<div class="markdown-body" id="article-content">
							<div class="loading">加载中...</div>
						</div>
					</div>
					<aside class="toc-sidebar" id="toc-sidebar">
						<h4>目录</h4>
						<div id="toc-content"></div>
					</aside>
				</div>
			</main>
			<main class="content" id="paste-page" style="display: none;">
				<div class="page-layout">
					<div class="main-content">
						<div class="article-header">
							<!-- <button id="backBtn" class="action-btn"><i class="fa-solid fa-arrow-left"></i> 返回</button> -->
							<button id="refreshBtn" class="action-btn"><i class="fa-solid fa-rotate"></i> 更新</button>
							<button id="copyRawBtn" class="action-btn"><i class="fa-solid fa-copy"></i> 复制原文</button>
							<button id="jumpOriginalBtn" class="action-btn"><i class="fa-solid fa-external-link"></i>
								跳转原文</button>
							<span id="saveTime" class="save-time"></span>
						</div>
						<div class="markdown-body" id="paste-content">
							<div class="loading">加载中...</div>
						</div>
					</div>
					<aside class="toc-sidebar" id="toc-sidebar">
						<h4>目录</h4>
						<div id="toc-content"></div>
					</aside>
				</div>
			</main>
		</div>
	</div>
	<script src="https://cdn.jsdmirror.com/gh/zym2013/amazing-luogu-international@main/function/framework.js"></script>
	<script src="https://cdn.jsdmirror.com/npm/marked@4.0.0/marked.min.js"></script>
	<script src="https://cdn.jsdmirror.com/npm/katex@0.16.27/dist/katex.min.js"></script>
	<script src="https://cdn.jsdmirror.com/npm/katex@0.16.27/dist/contrib/auto-render.min.js"></script>
	<script src="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.8.0/build/highlight.min.js"></script>
	<script>
		let currentRawContent = '';
		let currentType = '';
		let currentId = '';
		const customExtensions = [
			{
				name: 'alignBlock',
				level: 'block',
				start(src) { return src.match(/^:::\s*align\s*\{([^}]+)\}/)?.index; },
				tokenizer(src, tokens) {
					const match = src.match(/^:::\s*align\s*\{([^}]+)\}([\s\S]*?)\n:::/);
					if (match) {
						return {
							type: 'alignBlock',
							raw: match[0],
							align: match[1].trim(),
							content: match[2].trim()
						};
					}
				},
				renderer(token) {
					return `<div class="align-${token.align}">${marked.parse(token.content)}</div>`;
				}
			},
			{
				name: 'epigraph',
				level: 'block',
				start(src) { return src.match(/^:::\s*epigraph(\[([^\]]+)\])?\s*:::/)?.index; },
				tokenizer(src, tokens) {
					const match = src.match(/^:::\s*epigraph(\[([^\]]+)\])?\s*([\s\S]*?)\s*:::/);
					if (match) {
						return {
							type: 'epigraph',
							raw: match[0],
							author: match[2] || '',
							content: match[3].trim()
						};
					}
				},
				renderer(token) {
					const authorPart = `<p>${token.author ? token.author : 'unknown author'}</p>`;
					return `<div class="epigraph">${marked.parse(token.content)}${authorPart}</div>`;
				}
			},
			{
				name: 'foldable',
				level: 'block',
				start(src) { return src.match(/^:{3,}/)?.index; },
				tokenizer(src, tokens) {
					const match = src.match(/^(:{3,})\s*(\w+)?(\[([^\]]+)\])?(\s*\{([^}]+)\})?\s*([\s\S]*?)\s*\1/);
					if (match && (match[2] === 'info' || match[2] === 'warning' || match[2] === 'success' || match[2] === 'error' || match[2] === 'bug' || match[2] === 'flask')) {
						return {
							type: 'foldable',
							raw: match[0],
							foldType: match[2] || 'info',
							title: match[4] || '',
							options: match[6] || '',
							content: match[7].trim()
						};
					}
				},
				renderer(token) {
					const isOpen = token.options.includes('open');
					return `
						<details class="foldable ${token.foldType}" ${isOpen ? 'open' : ''}>
							<summary>${token.title || '点击展开'}</summary>
							${marked.parse(token.content)}
						</details>
					`;
				}
			}
		];
		marked.use({ extensions: customExtensions });
		function escapeHtml(str) {
			return str
				.replace(/&/g, '&amp;')
				.replace(/</g, '&lt;')
				.replace(/>/g, '&gt;')
				.replace(/"/g, '&quot;')
				.replace(/'/g, '&#039;');
		}
		const renderer = new marked.Renderer();
		renderer.code = function (code, language) {
			const lang = language || 'plaintext';
			let highlighted = code;
			if (language && hljs.getLanguage(lang)) {
				try {
					highlighted = hljs.highlight(code, { language: lang, ignoreIllegals: true }).value;
				} catch (e) { }
			}
			return `<div class="code-container"><pre><code class="language-${lang}">${highlighted}</code></pre></div>`;
		};
		marked.setOptions({
			breaks: false,
			gfm: true,
			mangle: false,
			headerIds: false,
			renderer: renderer,
		});
		function renderMarkdown(text) {
			const tmp = document.createElement('div');
			tmp.innerHTML = marked.parse(escapeHtml(text));
			renderMathInElement(tmp, {
				delimiters: [
					{ left: '$$', right: '$$', display: true },
					{ left: '$', right: '$', display: false },
					{ left: '\(', right: '\)', display: false },
					{ left: '\[', right: '\]', display: true }
				],
				strict: false
			});
			return tmp.innerHTML;
		}
		function showPage(pageKey) {
			const pages = ['home', 'article', 'paste'];
			pages.forEach(k => {
				const el = document.getElementById(`${k}-page`);
				if (el) el.style.display = 'none';
			});
			const target = document.getElementById(`${pageKey}-page`);
			if (target) target.style.display = 'block';
			document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
			let activePage;
			if (pageKey === 'home') {
				activePage = 'home';
			} else if (pageKey === 'article') {
				activePage = 'articles';
			} else if (pageKey === 'paste') {
				activePage = 'clipboard';
			}
			if (activePage) {
				const activeEl = document.querySelector(`.nav-item[data-page="${activePage}"]`);
				if (activeEl) activeEl.classList.add('active');
			}
		}
		async function loadArticle(id, forceRefresh = false) {
			try {
				showPage('article');
				currentType = 'article';
				currentId = id;
				const fetchOptions = { cache: 'no-store' };
				const url = `https://luogu-api.amlg.top/article/${id}` + (forceRefresh ? `?r=1` : '');
				const res = await fetch(url, fetchOptions);
				const data = await res.json();
				const article = data.data.data.article;
				currentRawContent = article.content || '';
				const rendered = renderMarkdown(currentRawContent);
				document.getElementById('article-content').innerHTML = rendered;
				document.getElementById('toc-content').innerHTML = generateTOC(rendered);
				bindTOCClick();
				const ts = article.time;
				document.getElementById('saveTime').textContent = ts ? `最后保存: ${formatUnixTime(ts)}` : '';
				updateBreadcrumb([
					{ text: '首页', href: '/' },
					{ text: '文章', href: '/a/y81xoxgi' },
					{ text: article.author.name + ' 的《' + (article.title || `文章 #${id}`) + '》' }
				]);
			} catch (e) {
				showPage('article');
				document.getElementById('article-content').innerHTML = '<p style="color:red">文章加载失败</p>';
			}
		}
		async function loadPaste(id, forceRefresh = false) {
			try {
				showPage('paste');
				currentType = 'paste';
				currentId = id;
				const fetchOptions = { cache: 'no-store' };
				const url = `https://luogu-api.amlg.top/paste/${id}` + (forceRefresh ? `?r=1` : '');
				const res = await fetch(url, fetchOptions);
				const data = await res.json();
				currentRawContent = data.data.data || '';
				const rendered = renderMarkdown(currentRawContent);
				document.getElementById('paste-content').innerHTML = rendered;
				document.getElementById('toc-content').innerHTML = generateTOC(rendered);
				bindTOCClick();
				const ts = data.data.time;
				document.getElementById('saveTime').textContent = ts ? `最后保存: ${formatUnixTime(ts)}` : '';
				updateBreadcrumb([
					{ text: '首页', href: '/' },
					{ text: '剪贴板', href: '/p/wnvx31ss' },
					{ text: data.data.user.name + ` 的剪贴板 #${id}` }
				]);
			} catch (e) {
				showPage('paste');
				document.getElementById('paste-content').innerHTML = '<p style="color:red">剪贴板加载失败</p>';
			}
		}
		function parseRoute() {
			const path = window.location.pathname;
			if (path.startsWith('/a/') || path.startsWith('/article/')) {
				const id = path.split('/')[2];
				if (id) loadArticle(id);
				else showPage('home');
			} else if (path.startsWith('/p/') || path.startsWith('/paste/')) {
				const id = path.split('/')[2];
				if (id) loadPaste(id);
				else showPage('home');
			} else {
				showPage('home');
				updateBreadcrumb([{ text: '首页', href: '/' }]);
			}
		}
		document.getElementById('goBtn')?.addEventListener('click', () => {
			const input = document.getElementById('urlInput');
			const raw = input.value.trim();
			if (!raw) return;
			let path = raw;
			if (raw.includes('://')) {
				try {
					const url = new URL(raw.startsWith('http') ? raw : 'https://' + raw);
					path = url.pathname;
				} catch (e) {
					alert('无效链接');
					return;
				}
			} else {
				const match = raw.match(/(?:www\.)?luogu\.com\.cn?(\/.*)/i);
				if (match) path = match[1];
				else path = '/' + raw.split('/').slice(1).join('/');
			}
			const articleMatch = path.match(/^\/(?:article|a)\/([^\/\?\#]+)/i);
			const pasteMatch = path.match(/^\/(?:paste|p)\/([^\/\?\#]+)/i);

			if (articleMatch) {
				window.location.pathname = `/a/${articleMatch[1]}`;
			} else if (pasteMatch) {
				window.location.pathname = `/p/${pasteMatch[1]}`;
			} else {
				alert('未识别到有效的文章或剪贴板 ID');
			}
		});
		document.getElementById('urlInput')?.addEventListener('keypress', (e) => {
			if (e.key === 'Enter') document.getElementById('goBtn').click();
		});
		document.addEventListener('DOMContentLoaded', () => {
			document.getElementById('copyRawBtn')?.addEventListener('click', copyRawContent);
			document.getElementById('jumpOriginalBtn')?.addEventListener('click', jumpOriginal);
			document.getElementById('backBtn')?.addEventListener('click', goBack);
			document.getElementById('refreshBtn')?.addEventListener('click', refreshData);
		});
		function formatUnixTime(ts) {
			if (!ts) return '';
			const d = new Date(ts * 1000);
			return d.toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
		}
		function generateTOC(html) {
			const tmp = document.createElement('div');
			tmp.innerHTML = html;
			const headers = tmp.querySelectorAll('h1, h2, h3, h4, h5, h6');
			if (headers.length === 0) return '';
			let toc = '';
			headers.forEach((h, i) => {
				const level = h.tagName.toLowerCase();
				const text = h.textContent.trim();
				const id = `toc-${level}-${i}`;
				h.id = id;
				toc += `<a href="#${id}" class="${level}">${text}</a>`;
			});
			return toc;
		}
		function bindTOCClick() {
			document.querySelectorAll('#toc-content a').forEach(a => {
				a.addEventListener('click', e => {
					e.preventDefault();
					const target = document.querySelector(a.getAttribute('href'));
					if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
				});
			});
		}
		async function copyRawContent() {
			if (!currentRawContent) return;
			try {
				await navigator.clipboard.writeText(currentRawContent);
				const btn = document.getElementById('copyRawBtn');
				const original = btn.innerHTML;
				btn.innerHTML = '<i class="fa-solid fa-check"></i> 已复制';
				setTimeout(() => btn.innerHTML = original, 1500);
			} catch (e) {
				alert('复制失败');
			}
		}
		function jumpOriginal() {
			if (!currentType || !currentId) return;
			const url = currentType === 'article'
				? `https://www.luogu.com/article/${currentId}`
				: `https://www.luogu.com/paste/${currentId}`;
			window.open(url, '_blank');
		}
		function goBack() {
			if (window.history.length > 1) window.history.back();
			else {
				window.location.pathname = '/';
				showPage('home');
			}
		}
		async function refreshData() {
			if (!currentType || !currentId) return;
			if (currentType === 'article') await loadArticle(currentId, true);
			else await loadPaste(currentId, true);
		}
		const originalParseRoute = parseRoute;
		parseRoute = function () {
			currentRawContent = '';
			currentType = '';
			currentId = '';
			originalParseRoute();
		}
	</script>
</body>

</html>
